version: '3'
services:
  nginx:
    image: nginx:alpine
    container_name: nginx
    volumes:
      - ./docker/dev.conf:/etc/nginx/conf.d/default.conf
      # - data:/etc/nginx
    ports:
      - 80:80
    networks:
      - dev
      - gateway
    depends_on:
      - backend
      - frontend

  frontend:
    build:
      context: .
      dockerfile: ./docker/Dockerfile-ui-pnpm
    container_name: frontend
    # volumes:
    #   - data:/etc/nginx/
    # ports:
    #   - 8080:8080
    #   - 3000:3000
    depends_on:
      - backend
    networks:
      - dev

  backend:
    build:
      context: .
      dockerfile: ./docker/Dockerfile-api-pnpm
    container_name: backend
    restart: always
    volumes:
      - ./apps/api/_uploads:/_uploads
    networks:
      - gateway
      - dev
    # ports:
    # - 3000:3000

volumes:
  data:
    driver: local

networks:
  gateway:
    external: true
  dev:
    driver: bridge
